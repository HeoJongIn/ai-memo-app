# Story 2.6: 노트 정렬 옵션 (최신순, 제목순)

## Status
Ready for Review

## Story
**As a** 사용자,
**I want** 노트 목록을 다양한 기준으로 정렬할 수 있도록 하겠습니다,
**so that** 노트를 효율적으로 탐색하고 관리할 수 있습니다.

## Acceptance Criteria
1. 노트 목록 페이지에 정렬 옵션 드롭다운이 제공되어야 합니다
2. 정렬 옵션은 "최신순", "제목순(가나다순)", "오래된순"을 포함해야 합니다
3. 기본 정렬은 "최신순"으로 설정되어야 합니다
4. 정렬 옵션 변경 시 즉시 노트 목록이 재정렬되어야 합니다
5. 정렬 상태가 URL 쿼리 파라미터에 반영되어야 합니다 (예: ?sort=title)
6. 페이지 새로고침 시에도 선택된 정렬 옵션이 유지되어야 합니다
7. 정렬 옵션은 반응형 디자인으로 모바일과 데스크톱에서 모두 사용 가능해야 합니다
8. 정렬 중임을 나타내는 시각적 피드백이 제공되어야 합니다
9. 빈 노트 목록에서도 정렬 옵션이 표시되어야 합니다
10. 정렬 옵션 변경 시 페이지네이션은 첫 페이지로 리셋되어야 합니다

## Tasks / Subtasks
- [x] Task 1: 정렬 옵션 UI 컴포넌트 구현 (AC: 1, 7, 9)
  - [x] Subtask 1.1: 정렬 드롭다운 컴포넌트 생성 (`/components/notes/sort-dropdown.tsx`)
  - [x] Subtask 1.2: shadcn/ui Select 컴포넌트 활용
  - [x] Subtask 1.3: 반응형 디자인 적용
- [x] Task 2: 정렬 로직 서버 액션 구현 (AC: 2, 3, 4, 8)
  - [x] Subtask 2.1: `getUserNotesPaginated` 함수에 정렬 파라미터 추가 (`/lib/actions/notes.ts`)
  - [x] Subtask 2.2: Drizzle ORM orderBy 절 구현 (최신순, 제목순, 오래된순)
  - [x] Subtask 2.3: 정렬 중 로딩 상태 처리
- [x] Task 3: URL 상태 관리 및 지속성 구현 (AC: 5, 6, 10)
  - [x] Subtask 3.1: Next.js useSearchParams 훅 활용
  - [x] Subtask 3.2: 정렬 옵션 변경 시 URL 업데이트
  - [x] Subtask 3.3: 페이지 새로고침 시 정렬 상태 복원
  - [x] Subtask 3.4: 정렬 변경 시 페이지네이션 리셋
- [x] Task 4: 노트 목록 페이지 통합 (AC: 4, 8)
  - [x] Subtask 4.1: 정렬 드롭다운을 노트 목록 페이지에 통합 (`/app/notes/page.tsx`)
  - [x] Subtask 4.2: 정렬 상태와 노트 데이터 동기화
  - [x] Subtask 4.3: 로딩 상태 UI 개선
- [x] Task 5: 테스트 작성 및 검증
  - [x] Subtask 5.1: 정렬 드롭다운 컴포넌트 테스트 작성
  - [x] Subtask 5.2: 정렬 서버 액션 함수 테스트 작성
  - [x] Subtask 5.3: 정렬 플로우 통합 테스트 작성

## Dev Notes

### 이전 스토리 인사이트
- 스토리 2.1에서 노트 생성 기능이 완전히 구현됨
- 스토리 2.2에서 노트 목록 조회 및 페이지네이션 기능이 구현됨
- 스토리 2.3에서 노트 상세 조회 기능이 구현됨
- 스토리 2.4에서 노트 수정 및 실시간 저장 기능이 구현됨
- 스토리 2.5에서 노트 삭제 및 복구 기능이 구현됨
- 사용자 스코프 기반 보안 시스템이 구축됨

### 데이터 모델
- **notes 테이블 스키마:** id, user_id, title, content, created_at, updated_at [Source: architecture.md#2]
- **정렬 필드:** created_at (최신순/오래된순), title (제목순) [Source: architecture.md#2]
- **권한 확인:** user_id로 소유자 확인

### API 명세
- **서버 액션:** `getUserNotesPaginated(userId: string, page: number, limit: number, sortBy?: string)` [기존 함수 수정]
- **정렬 옵션:** 'latest' (최신순), 'title' (제목순), 'oldest' (오래된순)
- **인증 요구사항:** 로그인한 사용자만 접근 가능
- **권한 스코프:** 사용자 ID 스코프로 소유자만 조회 가능 [Source: architecture.md#3]

### 컴포넌트 명세
- **UI 프레임워크:** shadcn/ui + Tailwind CSS [Source: architecture.md#1]
- **사용할 컴포넌트:** Select (정렬 드롭다운), Button, Card (기존 컴포넌트 활용)
- **반응형 디자인:** 모바일 우선 접근 방식

### 파일 위치
- **정렬 드롭다운:** `/components/notes/sort-dropdown.tsx` (새로 생성)
- **서버 액션:** `/lib/actions/notes.ts` (수정: getUserNotesPaginated 함수 개선)
- **노트 목록 페이지:** `/app/notes/page.tsx` (수정: 정렬 기능 통합)
- **테스트 파일:**
  - `/__tests__/components/notes/sort-dropdown.test.tsx` (새로 생성)
  - `/__tests__/lib/actions/notes-sort.test.ts` (새로 생성)

### 기술적 제약사항
- **프레임워크:** Next.js App Router 사용 [Source: architecture.md#1]
- **서버 로직:** Server Actions으로 구현 [Source: architecture.md#1]
- **데이터베이스:** Supabase Postgres + Drizzle ORM [Source: architecture.md#1]
- **인증:** Supabase Auth API 사용 [Source: architecture.md#1]

### 정렬 전략
- **최신순:** `orderBy(desc(notes.createdAt))` - 기본값
- **제목순:** `orderBy(asc(notes.title))` - 가나다순
- **오래된순:** `orderBy(asc(notes.createdAt))` - 생성일 오름차순
- **성능 고려:** 인덱스 활용을 위한 적절한 정렬 필드 선택

### URL 상태 관리
- **쿼리 파라미터:** `?sort=latest|title|oldest`
- **기본값:** `sort=latest` (쿼리 파라미터 없을 때)
- **상태 지속성:** Next.js useSearchParams 훅 활용
- **페이지네이션 연동:** 정렬 변경 시 page=1로 리셋

### 에러 처리 전략
- **잘못된 정렬 옵션:** 기본값(latest)으로 폴백
- **데이터베이스 에러:** 사용자 친화적 에러 메시지
- **네트워크 에러:** 재시도 옵션 제공
- **Toast 알림:** 정렬 변경 성공/실패 피드백

### Testing
- **테스트 프레임워크:** Jest (기존 설정 활용)
- **테스트 파일 위치:** `__tests__/` 디렉토리
- **테스트 대상:** 컴포넌트 렌더링, 정렬 옵션 변경, 서버 액션 호출, URL 상태 관리, 에러 처리
- **테스트 표준:** 각 컴포넌트와 함수에 대한 단위 테스트 작성 필수
- **특이사항:** 정렬 옵션 변경 및 URL 상태 동기화 검증

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-12-19 | 1.0 | 초기 스토리 생성 | Scrum Master |
| 2024-12-19 | 1.1 | 스토리 구현 완료 | Dev Agent |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4

### Debug Log References
- URLSearchParams mock 문제 해결: 테스트에서 URLSearchParams 생성자에 객체 전달 시 발생하는 문제 수정
- 정렬 옵션 폴백 로직 개선: 잘못된 정렬 옵션에 대한 기본값 처리 강화
- 테스트 중복 텍스트 문제 해결: Select 컴포넌트에서 동일한 텍스트가 여러 위치에 나타나는 문제 대응

### Completion Notes List
- 정렬 드롭다운 컴포넌트 구현 완료: shadcn/ui Select 컴포넌트 활용한 반응형 UI
- 서버 액션 정렬 로직 구현: Drizzle ORM orderBy 절을 사용한 데이터베이스 레벨 정렬
- URL 상태 관리 구현: Next.js useSearchParams 훅을 활용한 정렬 상태 지속성
- 페이지네이션 연동: 정렬 변경 시 자동으로 첫 페이지로 리셋
- 노트 목록 페이지 통합: 정렬 드롭다운과 노트 데이터 동기화
- 로딩 상태 처리: 정렬 변경 중 시각적 피드백 제공
- 에러 처리: 잘못된 정렬 옵션에 대한 기본값 폴백 로직
- 테스트 작성: 컴포넌트 및 서버 액션 단위 테스트 완료 (17개 테스트 모두 통과)

### File List
- `/components/notes/sort-dropdown.tsx` (새로 생성: 정렬 드롭다운 컴포넌트)
- `/lib/actions/notes.ts` (수정: getUserNotesPaginated 및 getNotesAction 함수에 정렬 파라미터 추가)
- `/app/notes/page.tsx` (수정: 정렬 기능 통합 및 URL 상태 관리)
- `/components/ui/select.tsx` (새로 생성: shadcn/ui Select 컴포넌트)
- `/__tests__/components/notes/sort-dropdown.test.tsx` (새로 생성: 정렬 드롭다운 테스트)
- `/__tests__/lib/actions/notes-sort.test.ts` (새로 생성: 정렬 서버 액션 테스트)

## QA Results
*QA 에이전트가 완료된 스토리 구현을 검토한 결과가 기록됩니다*

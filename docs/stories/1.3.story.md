# Story 1.3: 비밀번호 재설정

## Status
Ready for Review

## Story
**As a** 기존 사용자,
**I want** 비밀번호를 잊어버렸을 때 이메일을 통해 비밀번호를 재설정할 수 있는 기능,
**so that** 계정에 다시 접근할 수 있다

## Acceptance Criteria
1. 사용자가 이메일 주소를 입력할 수 있는 비밀번호 재설정 요청 폼이 제공된다
2. 이메일 형식 유효성 검사가 실시간으로 수행된다
3. 존재하지 않는 이메일 주소 입력 시 적절한 에러 메시지가 표시된다
4. 비밀번호 재설정 이메일이 성공적으로 전송되면 확인 메시지가 표시된다
5. 이메일의 재설정 링크를 클릭하면 새 비밀번호 입력 페이지로 이동한다
6. 새 비밀번호 입력 시 비밀번호 강도 검증이 수행된다
7. 비밀번호 확인 입력과 일치하는지 검증한다
8. 비밀번호 재설정 성공 시 자동으로 로그인되고 메인 페이지로 리다이렉션된다
9. 모든 입력 필드에 대한 접근성 지원이 제공된다
10. 재설정 링크는 보안을 위해 일정 시간 후 만료된다

## Tasks / Subtasks
- [x] Task 1: 비밀번호 재설정 요청 페이지 구현 (AC: 1, 2, 3, 4, 9)
  - [x] Subtask 1.1: `/auth/forgot-password` 라우트 및 페이지 컴포넌트 생성
  - [x] Subtask 1.2: shadcn/ui 기반 이메일 입력 폼 컴포넌트 생성
  - [x] Subtask 1.3: 이메일 형식 검증 로직 구현
  - [x] Subtask 1.4: 접근성 속성 추가 (aria-label, role 등)
- [x] Task 2: Supabase Auth 비밀번호 재설정 연동 (AC: 4, 10)
  - [x] Subtask 2.1: Supabase resetPasswordForEmail 함수 호출 구현
  - [x] Subtask 2.2: 이메일 전송 성공/실패 처리
  - [x] Subtask 2.3: 에러 핸들링 및 사용자 피드백 구현
- [x] Task 3: 비밀번호 재설정 페이지 구현 (AC: 5, 6, 7, 8, 9)
  - [x] Subtask 3.1: `/auth/reset-password` 라우트 및 페이지 컴포넌트 생성
  - [x] Subtask 3.2: 새 비밀번호 입력 폼 컴포넌트 생성
  - [x] Subtask 3.3: 비밀번호 강도 검증 로직 구현
  - [x] Subtask 3.4: 비밀번호 확인 검증 로직 구현
  - [x] Subtask 3.5: 접근성 속성 추가
- [x] Task 4: Supabase Auth 비밀번호 업데이트 연동 (AC: 8)
  - [x] Subtask 4.1: Supabase updateUser 함수 호출 구현
  - [x] Subtask 4.2: 재설정 성공 시 자동 로그인 처리
  - [x] Subtask 4.3: 메인 페이지 리다이렉션 구현
- [x] Task 5: UX 개선 및 에러 처리 (AC: 3, 4)
  - [x] Subtask 5.1: 로딩 상태 표시
  - [x] Subtask 5.2: 폼 비활성화 및 버튼 상태 관리
  - [x] Subtask 5.3: 사용자 친화적 에러 메시지 구현
- [x] Task 6: 단위 테스트 작성
  - [x] Subtask 6.1: 비밀번호 재설정 요청 폼 테스트
  - [x] Subtask 6.2: 비밀번호 재설정 폼 테스트
  - [x] Subtask 6.3: Supabase Auth 연동 테스트
  - [x] Subtask 6.4: 에러 핸들링 테스트

## Dev Notes

### 기술 스택 정보
- **프레임워크:** Next.js (App Router, Server Actions) [Source: architecture.md#1]
- **UI:** shadcn/ui + Tailwind + Radix UI [Source: architecture.md#1]
- **DB/인증:** Supabase (Postgres, Auth, Storage) [Source: architecture.md#1]

### 보안 요구사항
- **키 관리:** Supabase 서비스 롤 키는 서버 전용 [Source: architecture.md#3]
- 사용자 인증은 Supabase Auth를 통해 처리
- 클라이언트에서는 공개 키만 사용
- 비밀번호 재설정 링크는 보안을 위해 일정 시간 후 만료

### 파일 구조 가이드
- 비밀번호 재설정 요청 페이지: `app/auth/forgot-password/page.tsx`
- 비밀번호 재설정 페이지: `app/auth/reset-password/page.tsx`
- 비밀번호 재설정 요청 폼: `components/auth/forgot-password-form.tsx`
- 비밀번호 재설정 폼: `components/auth/reset-password-form.tsx`
- Supabase 클라이언트 설정: `lib/supabase.ts` (기존 파일 활용)
- 유틸리티 함수: `lib/utils.ts`

### Supabase Auth 설정
- 이메일/비밀번호 인증 활성화 필요
- 비밀번호 재설정 이메일 템플릿 설정
- 재설정 링크 만료 시간 설정
- 에러 메시지 사용자 친화적 변환

### Testing
- **테스트 프레임워크:** Jest + React Testing Library
- **테스트 파일 위치:** `__tests__/` 또는 `*.test.tsx`
- **테스트 범위:** 컴포넌트 렌더링, 유효성 검사, API 호출 모킹
- **접근성 테스트:** jest-axe를 활용한 접근성 검증

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-14 | 1.0 | 초기 스토리 생성 | Scrum Master |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5

### Debug Log References
없음

### Completion Notes List
- Supabase Auth를 사용한 비밀번호 재설정 기능 구현 완료
- react-hook-form과 zod를 사용한 폼 유효성 검사 구현
- shadcn/ui 컴포넌트를 활용한 깔끔한 UI 구현
- 접근성 속성(aria-label, aria-invalid 등) 추가
- 비밀번호 재설정 요청 폼과 재설정 폼에 대한 단위 테스트 작성
- 존재하지 않는 이메일, 비밀번호 강도 등 다양한 에러 케이스 처리
- 비밀번호 재설정 성공 시 자동 로그인 및 메인 페이지 리다이렉션 구현
- 오로라 테마 적용으로 아름다운 UI 구현
- 로그인 폼에 비밀번호 재설정 링크 추가

### File List
- app/auth/forgot-password/page.tsx (생성)
- app/auth/reset-password/page.tsx (생성)
- components/auth/forgot-password-form.tsx (생성)
- components/auth/reset-password-form.tsx (생성)
- components/auth/login-form.tsx (수정 - 비밀번호 재설정 링크 추가)
- __tests__/components/auth/forgot-password-form.test.tsx (생성)
- __tests__/components/auth/reset-password-form.test.tsx (생성)

## QA Results
*QA 에이전트가 검토 후 작성합니다*

# Story 1.4: 로그아웃 기능

## Status
Ready for Review

## Story
**As a** 로그인된 사용자,
**I want** 안전하게 로그아웃할 수 있는 기능,
**so that** 다른 사용자가 내 계정에 접근할 수 없도록 보호할 수 있다

## Acceptance Criteria
1. 로그인된 사용자에게 로그아웃 버튼이 표시된다
2. 로그아웃 버튼 클릭 시 확인 대화상자가 표시된다
3. 확인 시 Supabase 세션이 완전히 종료된다
4. 로그아웃 후 자동으로 메인 페이지로 리다이렉션된다
5. 로그아웃 후 브라우저의 로컬 스토리지가 정리된다
6. 로그아웃 중 로딩 상태가 표시된다
7. 로그아웃 실패 시 적절한 에러 메시지가 표시된다
8. 로그아웃 버튼에 대한 접근성 지원이 제공된다
9. 로그아웃 후 다른 페이지 접근 시 인증이 필요한 페이지로 리다이렉션된다
10. 로그아웃 상태가 모든 컴포넌트에 즉시 반영된다

## Tasks / Subtasks
- [x] Task 1: 로그아웃 버튼 UI 구현 (AC: 1, 8)
  - [x] Subtask 1.1: 메인 페이지 로그아웃 버튼 스타일링 개선
  - [x] Subtask 1.2: 네비게이션 바에 로그아웃 버튼 추가 (향후 확장)
  - [x] Subtask 1.3: 접근성 속성 추가 (aria-label, role 등)
- [x] Task 2: 로그아웃 확인 대화상자 구현 (AC: 2)
  - [x] Subtask 2.1: shadcn/ui Dialog 컴포넌트 활용한 확인 모달 생성
  - [x] Subtask 2.2: 확인/취소 버튼 구현
  - [x] Subtask 2.3: 접근성 속성 및 키보드 네비게이션 지원
- [x] Task 3: Supabase Auth 로그아웃 연동 (AC: 3, 5)
  - [x] Subtask 3.1: Supabase signOut 함수 호출 구현
  - [x] Subtask 3.2: 세션 완전 종료 확인
  - [x] Subtask 3.3: 로컬 스토리지 정리 로직 구현
- [x] Task 4: 상태 관리 및 리다이렉션 (AC: 4, 9, 10)
  - [x] Subtask 4.1: 로그아웃 후 메인 페이지 리다이렉션
  - [x] Subtask 4.2: 전역 인증 상태 업데이트
  - [x] Subtask 4.3: 모든 컴포넌트 상태 동기화
- [x] Task 5: UX 개선 및 에러 처리 (AC: 6, 7)
  - [x] Subtask 5.1: 로그아웃 중 로딩 상태 표시
  - [x] Subtask 5.2: 버튼 비활성화 및 상태 관리
  - [x] Subtask 5.3: 로그아웃 실패 시 에러 메시지 표시
- [x] Task 6: 단위 테스트 작성
  - [x] Subtask 6.1: 로그아웃 버튼 렌더링 테스트
  - [x] Subtask 6.2: 확인 대화상자 테스트
  - [x] Subtask 6.3: Supabase Auth 연동 테스트
  - [x] Subtask 6.4: 상태 업데이트 및 리다이렉션 테스트

## Dev Notes

### 기술 스택 정보
- **프레임워크:** Next.js (App Router, Server Actions) [Source: architecture.md#1]
- **UI:** shadcn/ui + Tailwind + Radix UI [Source: architecture.md#1]
- **DB/인증:** Supabase (Postgres, Auth, Storage) [Source: architecture.md#1]

### 보안 요구사항
- **키 관리:** Supabase 서비스 롤 키는 서버 전용 [Source: architecture.md#3]
- 사용자 인증은 Supabase Auth를 통해 처리
- 클라이언트에서는 공개 키만 사용
- 로그아웃 시 모든 세션 정보 완전 삭제

### 파일 구조 가이드
- 로그아웃 확인 대화상자: `components/auth/logout-dialog.tsx`
- 로그아웃 훅: `hooks/use-logout.ts` (선택사항)
- Supabase 클라이언트 설정: `lib/supabase.ts` (기존 파일 활용)
- 유틸리티 함수: `lib/utils.ts`

### Supabase Auth 설정
- 이메일/비밀번호 인증 활성화 필요
- 세션 관리 및 자동 갱신 설정
- 로그아웃 시 세션 완전 종료 확인

### Testing
- **테스트 프레임워크:** Jest + React Testing Library
- **테스트 파일 위치:** `__tests__/` 또는 `*.test.tsx`
- **테스트 범위:** 컴포넌트 렌더링, 사용자 상호작용, API 호출 모킹
- **접근성 테스트:** jest-axe를 활용한 접근성 검증

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-14 | 1.0 | 초기 스토리 생성 | Scrum Master |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5

### Debug Log References
없음

### Completion Notes List
- Supabase Auth를 사용한 안전한 로그아웃 기능 구현 완료
- shadcn/ui Dialog 컴포넌트를 활용한 확인 대화상자 구현
- 접근성 속성 및 키보드 네비게이션 지원
- 로그아웃 다이얼로그에 대한 단위 테스트 작성
- 로그아웃 실패 시 에러 메시지 처리
- 로그아웃 중 로딩 상태 표시 및 버튼 비활성화
- 로그아웃 성공 시 메인 페이지 리다이렉션 구현
- 오로라 테마 적용으로 아름다운 UI 구현
- 세션 완전 종료 및 로컬 스토리지 정리

### File List
- components/auth/logout-dialog.tsx (생성)
- app/page.tsx (수정 - 로그아웃 다이얼로그 연동)
- __tests__/components/auth/logout-dialog.test.tsx (생성)

## QA Results
*QA 에이전트가 검토 후 작성합니다*
